{% extends "admin/file_manager/base.html" %}
{% load i18n %}

{% block breadcrumbs %}
<div class="breadcrumbs">
	<a href="">{% trans "Home" %}</a> &rsaquo;
	<a href="{% url index %}">{% trans "File Manager" %}</a> &rsaquo;
	{% trans 'Listing' %}
</div>
{% endblock %}

{% block content %}
<h1>Directory: '/{{ directory.url }}'</h1>

{% if directory.url %}
    <a href="{% url list directory.parent %}">Up one</a>
{% endif %}

{% if directory.can_write %}
	<a href="{% url mkdir directory.url %}">Mkdir</a>
	<a href="{% url create directory.url %}">Create File</a>
	<a href="{% url upload directory.url %}">Upload</a>
{% endif %}

<table>
	<tr>
		<td>Name</td>
		<td>Size</td>
		<td>Permissions</td>
		<td>Created</td>
		<td>Modified</td>
		<td>User</td>
		<td>Group</td>
		<td>Actions</td>
	</tr>

{% regroup files|dictsortreversed:"directory" by directory as file_list %}

{% for dfile in file_list %}

{% for file in dfile.list|dictsort:"filename" %}
	<tr>
		<td>
			{% if file.directory %}D{% endif %}	
			<a href="{% if file.directory %}{% url list file.fileurl %}{% else %}/{{ file.fileurl }}{% endif %}">{{ file.filename }}</a>

		</td>
		<td>
			{% if not file.directory %}
				{{ file.size|filesizeformat }}
			{% endif %}	
		</td>
		<td>{{ file.perms }}</td>
		<td>{{ file.ctime|date:"m/d/Y" }}</td>
		<td>{{ file.mtime|date:"m/d/Y" }}</td>
		<td>{{ file.user }}</td>
		<td>{{ file.group }}</td>
		<td>
			{% if directory.can_write %}
				<a href="{% url rename file.fileurl %}">R</a> /
				<a href="{% url move file.fileurl %}">M</a> /
				<a href="{% url delete file.fileurl %}">D</a> /
			{% endif %}
			{% if not file.directory and file.can_edit  %}
				<a href="{% url update file.fileurl %}">Edit</a> /
			{% endif %}
			<a href="{% url copy file.fileurl %}">Copy</a>
		</td>
	</tr>
{% endfor %}

{% endfor %}

</table>

{% endblock %}
